# 笔记部分

## Make用法

1.  $(shell < shell-command >)

  执行一个shell命令，将执行结果返回；

2. @用法

  1. 将“@”字符用在命令前，改命令将不会被make显示出来

    @echo 正在编译XXX模块---> 正在编译XXX模块

  2. $@表示目标集， $< 表示所有的依赖目标集

3. call函数
  call函数时唯一一个可以用来创建新的参数化的函数


## shell编程

1. dd命令用于文件的复制
2. /dev/null是unix中一个吸收无效输出的设备，/dev/zero可以产生无限空字节的输入设备-->一般用来初始化某一区域


## gcc编译器

gcc的编译源代码过程分为四步，预处理-->编译-->汇编-->链接


## C语言用法

1. 函数指针

  函数指针通过输入值，输出值进行标识

  比如：

  > void (*ptr)(void);

  同时，函数指针还支持一种“匿名式”的写法

  ```
  #include <stdio.h>

  void test(void)
  {
      printf("Just a test!");
      return;
  }

  int main()
  {
      ((void (*)(void))(&test))();
      return 0;
  }

  ```

2. 指针和整数加法的区别

  ```
  #include <stdio.h>
  #include <stdint.h>

  int main()
  {
      uint32_t ebp = 0x00007b08;
      uint32_t *ri = (uint32_t *)ebp + 0x2; //7b10
      uint32_t *wr = (uint32_t *)(ebp + 0x2); // 7b0a
      printf("%08x\n", ri);
      printf("%08x\n", wr);
      return 0;
  }

  ```

  指针的加法意味着以当前类型为单位，指向差额的下一个单位
  整数的加法则是进位加法


----------------------------

# 习题部分

## 练习1

1. ucore.img如何生成

  ucore依赖于bootblock和kernel，bootblock和kernel通过设置gcc编译源代码生成，再通过ld链接成可执行文件，最后通过dd命令，生成最终的ucore.img文件


2. 一个被系统认为是符合规范的硬盘主引导扇区的特征是什么
  以MBR为例，一个Block。即一个扇区，为512字节。Boot按照约定，应该在当前硬盘的0柱面，0磁头，1扇区。

  这一扇区，即boot，由以下三部分组成：
    1. 主引导程序代码，占446字节
    2. 硬盘分区表DPT，占64字节
    3. 主引导扇区结束标志AA55H(2个字节)

## 练习2

1. QEMU的调试方法
  ```
  QEMU常用的调试启动命令:qemu -S -s -hda ./bin/ucore.img -monitor stdio
  ```
2. GDB常用的调试启动方式
  ```
  file bin/kernel  # 读取带调试符号信息的文件
  target remote :1234  # 连接远程调试端口
  set architecture i386 # 设置芯片类型
  b *0x7c00  # 设置断点
  continue   # 执行到下一断点
  x /2i $pc  # Examine memory: x/FMT ADDRESS
  ```
3. GDB其他命令

  3.1 代码的反汇编
    ```
    define hook-stop
    x/i $pc
    end
    ```

  3.2 gdb的单步命令
    ```
    next 单步到程序源代码的下一行，不进入函数
    nexti 单步一条机器指令，不进入函数
    step 单步到下一个不同的源代码行（包括进入函数）
    stepi 单步一条机器指令
    ```

## 练习3

1. 为何开启A20,以及如何开启A20

  A20是为了实现向下兼容，而设计的电路。打开A20,可以实现完整内存的寻址。

  操作相应的端口，可以实现A20的开启。

2. 如何初始化GDT表

  GDT的信息保存在一个特殊的寄存器--全局描述符表寄存器（GDTR）中，高32位作为基地址，低16位作为段界限。

3. 如何使能和进入保护模式

  将%cro置为1

## 练习4

1. bootloader如何读取硬盘扇区的

  通过inb函数设置硬盘寄存器，将整个扇区读到特定内存位置，其余功能基于扇区读取进行封装。

2. bootloader是如何加载ELF格式的OS

  从固定地址读取OS的ELFHDR，再根据ELFHDR里的信息，通过函数指针，执行后续的功能。


## 练习5

  编程实现，注意一些写法

## 练习6

  





















END
